{% extends "_baseTemplate.html" %}
{% block title %}Make an appointment{% endblock %}

{% block content %}
<h2 style="text-align: center; padding: 20px;">Make an appointment</h2>
<form method="POST">
    <div class="form-group row mb-3">
        <label for="specialization" class="col-sm-2 col-form-label">Specialization:</label>
        <div class="col-sm-10">
            <select id="specialization" name="specialization" class="form-control" onchange="filterDoctors()" required>
                <option value="" disabled selected>Select a specialization</option>
                {% for specialization in specializations %}
                    <option value="{{ specialization.specializationID }}"
                        {% if selected_specialization and specialization.specializationID == selected_specialization.specializationID %}
                        selected
                        {% endif %}>
                        {{ specialization.specialization_name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="form-group row mb-3">
        <label for="doctor" class="col-sm-2 col-form-label">Doctor:</label>
        <div class="col-sm-10">
            <select id="doctor" name="doctor" class="form-control" required>
                <option value="" disabled selected>Select a doctor</option>
                {% for doctor in doctors %}
                    {% if selected_doctor and doctor.medicID == selected_doctor.medicID %}
                        <option value="{{ doctor.medicID }}" 
                                data-specialization="{{ doctor.specializationID }}"
                                selected>
                            {{ selected_doctor.username }}
                        </option>
                    {% else %}
                        <option value="{{ doctor.medicID }}" 
                                data-specialization="{{ doctor.specializationID }}">
                            {{ doctor.username }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>            
        </div>
    </div>

    <div class="form-group row mb-3">
        <label for="appointmentDatetime" class="col-sm-2 col-form-label">Appointment Date:</label>
        <div class="col-sm-10">
            <input type="datetime-local" id="appointmentDatetime" name="appointmentDatetime" class="form-control" required>
        </div>
    </div>

    <div class="form-group row mb-3">
        <label for="notes" class="col-sm-2 col-form-label">Notes:</label>
        <div class="col-sm-10">
            <textarea id="notes" name="notes" class="form-control"></textarea>
        </div>
    </div>

    <div class="form-group row">
        <div class="col-sm-10 offset-sm-2">
            <button type="submit" class="btn btn-primary">Create Consultation</button>
        </div>
    </div>
</form>

<script>
    function filterDoctors() {
        var specializationId = document.getElementById('specialization').value;
        console.log(specializationId);
        var doctorSelect = document.getElementById('doctor');
        var options = doctorSelect.options;
        var found = false;

        // Clear previous selection
        doctorSelect.selectedIndex = 0;

        // Hide all doctors initially
        for (var i = 0; i < options.length; i++) {
            options[i].style.display = 'none';
        }

        // Show doctors that match the selected specialization
        for (var i = 0; i < options.length; i++) {
            var option = options[i];
            if (option.getAttribute('data-specialization') == specializationId) {
                option.style.display = 'block';
                found = true;
            }
        }

        // If no doctors are found, add "No doctors found" option
        if (!found) {
            var noDoctorOption = document.createElement('option');
            noDoctorOption.value = "";
            noDoctorOption.disabled = true;
            noDoctorOption.selected = true;
            noDoctorOption.text = "No doctors found";
            doctorSelect.appendChild(noDoctorOption);
        }
        console.log(doctorSelect);
    }

    // Call filterDoctors() when the page loads to handle default doctor visibility and pre-selection
    window.onload = function() {
        filterDoctors();
    };
</script>

{% endblock %}
